# Makefile for DoPlan v0.0.18-beta Development

.PHONY: help setup test test-unit test-integration clean validate migrate deps benchmark

help: ## Show this help message
	@echo "DoPlan v0.0.18-beta Development Commands"
	@echo ""
	@echo "Usage: make [target]"
	@echo ""
	@echo "Targets:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "  %-20s %s\n", $$1, $$2}'

setup: ## Set up test environment
	@./scripts/setup-test-env.sh

test: ## Run all tests
	@./scripts/run-all-tests.sh

test-unit: ## Run unit tests only
	@go test ./internal/... -v

test-integration: ## Run integration tests
	@./scripts/test-migration.sh
	@./scripts/test-ide-integration.sh

clean: ## Clean test environment
	@./scripts/clean-test-env.sh

validate: ## Validate migration
	@./scripts/validate-migration.sh

migrate: ## Run interactive migration
	@echo "Migration wizard will be implemented in TUI"

deps: ## Check dependencies
	@./scripts/check-dependencies.sh

benchmark: ## Run performance benchmarks
	@go test -bench=. ./internal/... -benchmem

backup: ## Backup test projects
	@./scripts/backup-test-projects.sh

restore: ## Restore test projects (usage: make restore TIMESTAMP=20240115-103000)
	@if [ -z "$(TIMESTAMP)" ]; then \
		echo "Usage: make restore TIMESTAMP=20240115-103000"; \
		exit 1; \
	fi
	@./scripts/restore-test-projects.sh $(TIMESTAMP)

build: ## Build DoPlan CLI
	@go build -o bin/doplan ./cmd/doplan

install: ## Install DoPlan CLI
	@go install ./cmd/doplan

fmt: ## Format code
	@go fmt ./...

lint: ## Run linter
	@golangci-lint run ./...

